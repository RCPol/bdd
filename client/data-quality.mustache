<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">

	<!-- Google fonts -->
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic|Roboto+Condensed' rel='stylesheet' type='text/css'>

	<!-- Css Documento -->
	<link rel="stylesheet" href="/css/{{base}}_glossario.css">

	<!-- jQuery -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
	<link rel="stylesheet" href="/bower_components/jquery-ui/themes/base/jquery-ui.min.css">

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Import materialize.css-->
	<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.3/css/materialize.min.css"  media="screen,projection"/>

	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
		ul {
			width:100%			
		}
		li {
			width:100%
		}
	</style>

	<title>RCPol - Data Quality</title>
</head>
<body>
<div class="contem">
	<!-- Início Header: Menu e Logotipo -->
	<header>
		<!-- Menu: início -->
		
		<!-- Menu: fim -->
		<!-- logotipo -->
		<div class="logo">
			<img src="/img/logo.png" alt="RCPol - Rede de Cat&aacute;logos Pol&iacute;nicos online" height="150px">
		</div>
		<!-- logotipo -->

	</header>
	<!-- Fim Header: Menu e Logotipo -->
	
		<div class="container" style="width:100%">
			<article>
				<div class="row">
					<div class="col s12">
						<h1 class="glo-tit" id="rcpol-Admin-siteGlossary" style="margin-bottom: 0px">Data Quality</h1>
					</div>
				</div>
				<div class="row" style="padding: 0em 2em 0em 0em">
					<div class="title col s12">											
						<h3 style="font-size: 150%; margin:0px margin-bottom:1em">Spreadsheet Input</h3> 
					</div>										
					<div class="input-field col s12">
						<input id="url-specimen" value="" placeholder="https://docs.google.com/spreadsheets/d/1gH0aa2qqnAgfAixGom3Gnx6Qp91ZvWhUHPb_QeoIreQ/edit#gid=765248797" id="url" type="text" class="validate">
						<label class="active" for="url">Spreadsheet URL:</label>
					</div>										
				</div>
				<div class="row" style="padding: 0em 2em 0em 0.3em">
					<div class="title col s12">											
						<h3 style="font-size: 150%; margin:0px">Spreadsheet Information</h3> 
					</div>										
					<div class="input-field col s4">											
						<p><b>Base:</b> <span id="base-specimen"></span></p> 
					</div>
					<div class="input-field col s4">											
						<p><b>Original language:</b> <span id="lang-specimen"></span></p> 
					</div>
					<div class="input-field col s4">											
						<p><b>Title:</b> <span id="title-specimen"></span></p> 
					</div>
				</div>
				<div class="row">
					<div class="col s12">
						<ul class="collapsible">
							<li>
							<div id="specimen-tab" class="collapsible-header"><i class="material-icons">bug_report</i>Specimens</div>
							<div class="collapsible-body">																	
									
									<div class="row">
										<div class="input-field col s12">											
											<h3 style="font-size: 150%; margin:0px">DQ Measurements</h3> 
										</div>
										<div class="input-field col s3">											
											<a style="font-size:90%" class="waves-effect waves-light btn-large" id="completeness-specimen">Completeness </a> 
										</div>
										<div class="input-field col s3">											
											<a style="font-size:90%" class="waves-effect waves-light btn-large">Consistency <span id="consistency-specimen"></span></a> 
										</div>
										<div class="input-field col s3">											
											<a style="font-size:90%" class="waves-effect waves-light btn-large">Conformity <span id="conformity-specimen"></span></a> 
										</div>
										<div class="input-field col s3">											
											<a style="font-size:90%" class="waves-effect waves-light btn-large">Accessibility <span id="accessibility-specimen"></span></a> 
										</div>
										<div class="input-field col s12">											
											<h3 style="font-size: 150%; margin:0px">DQ Amendments</h3> 
										</div>
										<div class="col s12">											
											 <table>
												<thead>
												<tr>
													<th>Amendment</th>
													<th>Field</th>
													<th>Row</th>
													<th>Value</th>
												</tr>
												</thead>

												<tbody id="specimen-amendment">

												</tbody>
											</table>
											

										</div>
										
									</div>
								
							</div>
							</li>
							<li>
							<div class="collapsible-header"><i class="material-icons">assignment</i>Schema</div>
							<div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>
							</li>
							<li>
							<div class="collapsible-header"><i class="material-icons">account_balance</i>Institutions</div>
							<div class="collapsible-body"><span>Lorem ipsum dolor sit amet.</span></div>
							</li>
						</ul>
					</div>				
				</div>			
			</article>	
		</div>
	
	<!-- Final das informações da Palinoteca -->		
	<!-- Início do Rodapé -->
	<footer>
		<p>Copyright &copy; 2016 RCPol - Todos os direitos reservados e outras informa&ccedil;&otilde;es</p>
	</footer>
	<!-- Final do Rodapé -->	
</div>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.3/js/materialize.min.js"></script>
	<script type="text/javascript">    	  
		$(document).ready(function(){			
			$('.collapsible').collapsible();
			$('.tabs').tabs();			 
			$("#url-specimen").change(function() {		
				var id = $("#url-specimen").val().split("d/")[1].split("/")[0]		
				$.get("/api/Specimens/getSpreadsheetInfo?id="+id,function(rs) {					
					var completeness = 0;
					var totalCells = 0;						
					if(!rs.response.properties) return null;					
					var base = rs.response.properties.title.split("[")[1].split("]")[0]
					var lang = rs.response.properties.title.split("[")[2].split("]")[0]
					$("#title-specimen").html(rs.response.properties.title);
					$("#base-specimen").html(base);
					$("#lang-specimen").html(lang);					
					$.get("/api/Specimens/completeness?id="+id+"&language="+lang,function(rs) {
						$("#specimen-amendment").html("");
						var header = rs.response.slice(0,5);
						rs.response.forEach(function(line, index){
							
							line.forEach(function(cell, i){
								if(i>0){
									if(String(cell).trim().length == 0){
										completeness++;										
										// $("#specimen-amendment").append(`<p>
										// 	<a style="text-align: left" class="collection-item" target="_blank" href="https://docs.google.com/spreadsheets/d/${id}/edit">
										// 		"${header[4][i]}" in the row <strong>${index}</strong>
										// 	</a>
										// </p>`);
										$("#specimen-amendment").append(`<tr>
													<td>Complete</td>
													<td>${header[4][i]}</td>
													<td>${index+1}</td>
													<td>${String(cell).trim()}</td>													
												</tr>												
											`);										
									}
									totalCells++;
								}
							});
						});		
						var finalCompleteness = (((totalCells-completeness)/totalCells)*100).toFixed(0)
						$("#completeness-specimen").html(`Completeness: ${finalCompleteness}%`);						
						if(finalCompleteness < 100){
							$("#specimen-tab").addClass("red-text");
							$("#completeness-specimen").addClass("red");
						} else {
							$("#specimen-tab").addClass("green-text");
							$("#completeness-specimen").addClass("green");
						}
					});
				});
			});
			// Grupo de aplicação da tecnologia Blockchain
		});  
	</script>
</body>
</html>
